
######################################################################################################
# M106 - because apparently you can only have one part cooling fan in klipper
######################################################################################################

[gcode_macro M106]
gcode:
    {% set S = params.S|float %}
    {% set SPEED = 0.0 %}

    {% if S > 0.0 %}
      {% if S > 255.0 %}
        {% set SPEED = 1.0 %}
      {% else %}
        {% set SPEED = S / 255 %}
      {% endif %}
    {% endif %}

    {% if S <= 0.0%}
      {% set SPEED = 0.0 %}
    {% endif %}

    #SET_PIN PIN=part_fan0 VALUE={S}
    #SET_PIN PIN=part_fan1 VALUE={S}
    SET_FAN_SPEED FAN=part_fan0 SPEED={SPEED}
    SET_FAN_SPEED FAN=part_fan1 SPEED={SPEED}
